import { AfterViewInit, Component, ElementRef, OnInit, ViewChild } from '@angular/core';
import { FormControl, FormGroup, Validators } from '@angular/forms';
import { ActivatedRoute } from '@angular/router';
import { ResearchDataService } from '../Services/research-data.service';
import { Location } from '@angular/common';
import { IAgg } from '../Models/ResearchData';
import  'anychart';
import { Subscription } from 'rxjs';

@Component({
  selector: 'app-research',
  templateUrl: './research.component.html',
  styleUrls: ['./research.component.css']
})
export class ResearchComponent implements OnInit, AfterViewInit {

  historicalStockData: IAgg[] = [];
  chart: anychart.charts.Stock;
  public errorMsg: string = "";
  subscriptions: Subscription[] = [];
  visible: boolean = false;

  @ViewChild('chartContainer') container!: ElementRef;

  public researchForm = new FormGroup({
    researchSymbolControl: new FormControl('', [
      Validators.required,
      Validators.minLength(1),
      Validators.maxLength(8)
    ])
  });

  constructor(private researchService: ResearchDataService, private location: Location, private route: ActivatedRoute) {
    this.chart = anychart.stock();
  }

  ngOnInit(): void { }

  ngAfterViewInit(){ }

  get researchSymbolControl() { return this.researchForm.get('researchSymbolControl'); }

  onGetData(): void {
    let subscription1: Subscription = new Subscription();
    let symbol: string = this.researchSymbolControl!.value;

    subscription1 = this.researchService.getHistoricalstockData(symbol).subscribe(
      (data) => {
        this.historicalStockData = data;
        this.ChartData(data);
        this.visible = true;
      },
      (error) => {
        console.log('(component)Error in getting research: ', error);
        this.errorMsg = `Error: ${error.error.title}`;
      },
      () => {"(component)Research retrieval complete"}
    );

    this.subscriptions.push(subscription1);
  }

  private ChartData(inputData: any[]){
    let ticker: string = String(this.researchSymbolControl?.value).trim().toUpperCase();

    // Clear existing chart
    if(this.chart) {this.chart.dispose();}
    this.chart = anychart.stock();

    // Format data
    let data = this.ConvertIAggArrayToArrayOfArrays(inputData);

    let table = anychart.data.table();
    
    //table.addData(data);
    table.addData([
      [
        "8/7/2019",
        64.63,
        65.32,
        63.64,
        65.14,
        16042599,
      ],
      [
        "8/8/2019",
        65.85,
        66.79,
        65.63,
        66.76,
        11451566,
      ],
      [
        "8/9/2019",
        66.33,
        66.57,
        65.21,
        66.06,
        11486100,
      ],
      [
        "8/12/2019",
        64.61,
        64.79,
        63.84,
        64.24,
        11548132,
      ],
      [
        "8/13/2019",
        63.9,
        65.96,
        63.51,
        64.83,
        17135940,
      ],
      [
        "8/14/2019",
        62.88,
        63.04,
        61.18,
        61.4078,
        24312365,
      ],
      [
        "8/15/2019",
        61.98,
        62.37,
        60.72,
        61.32,
        14619462,
      ],
      [
        "8/16/2019",
        61.93,
        63.66,
        61.85,
        63.47,
        13855586,
      ],
      [
        "8/19/2019",
        64.82,
        64.91,
        64.16,
        64.31,
        10902534,
      ],
      [
        "8/20/2019",
        63.72,
        64.085,
        63.35,
        63.44,
        8559805,
      ],
      [
        "8/21/2019",
        64.13,
        64.17,
        63.06,
        63.23,
        11213190,
      ],
      [
        "8/22/2019",
        63.81,
        64.21,
        63.4102,
        63.92,
        7816075,
      ],
      [
        "8/23/2019",
        63.28,
        64.13,
        61.52,
        61.96,
        14686668,
      ],
      [
        "8/26/2019",
        62.57,
        62.82,
        62.17,
        62.74,
        8742245,
      ],
      [
        "8/27/2019",
        63.01,
        63.1,
        61.16,
        61.64,
        12974070,
      ],
      [
        "8/28/2019",
        61.3,
        62.8,
        61.3,
        62.365,
        10105807,
      ],
      [
        "8/29/2019",
        63.31,
        64.23,
        63.1,
        63.9,
        10369100,
      ],
      [
        "8/30/2019",
        64.34,
        64.82,
        64.1855,
        64.31,
        9327411,
      ],
      [
        "9/3/2019",
        64,
        64.04,
        62.32,
        63.415,
        10986298,
      ],
      [
        "9/4/2019",
        64,
        64.48,
        63.84,
        64.29,
        8716732,
      ],
      [
        "9/5/2019",
        65.65,
        67.28,
        65.61,
        66.32,
        13363616,
      ],
      [
        "9/6/2019",
        66.19,
        66.5,
        65.75,
        65.97,
        9192440,
      ],
      [
        "9/9/2019",
        66.76,
        69.3,
        66.69,
        68.79,
        16972603,
      ],
      [
        "9/10/2019",
        69.18,
        70.01,
        68.45,
        68.99,
        16507191,
      ],
      [
        "9/11/2019",
        68.72,
        69.2124,
        68.11,
        68.87,
        10679392,
      ],
      [
        "9/12/2019",
        68.11,
        70.055,
        68.01,
        69.32,
        13456455,
      ],
      [
        "9/13/2019",
        70.34,
        70.74,
        69.85,
        70.38,
        12610890,
      ],
      [
        "9/16/2019",
        68.96,
        70.11,
        68.96,
        69.83,
        8466456,
      ],
      [
        "9/17/2019",
        69.78,
        69.78,
        68.67,
        69.46,
        8727670,
      ],
      [
        "9/18/2019",
        69.21,
        70.345,
        68.96,
        70.08,
        9344831,
      ],
      [
        "9/19/2019",
        70.06,
        70.47,
        69.59,
        69.7,
        8271644,
      ],
      [
        "9/20/2019",
        70.15,
        70.54,
        69.33,
        69.34,
        16123622,
      ],
      [
        "9/23/2019",
        68.62,
        69.7,
        68.61,
        69.545,
        6814967,
      ],
      [
        "9/24/2019",
        69.5,
        69.57,
        67.555,
        67.9,
        13542421,
      ],
      [
        "9/25/2019",
        67.91,
        69.7,
        67.87,
        69.41,
        9697183,
      ],
      [
        "9/26/2019",
        69.32,
        69.53,
        68.8,
        69.13,
        7423227,
      ],
      [
        "9/27/2019",
        69.82,
        70.36,
        69.0553,
        69.47,
        8965665,
      ],
      [
        "9/30/2019",
        69.7965,
        69.9,
        69.01,
        69.09,
        6144215,
      ],
      [
        "10/1/2019",
        69.57,
        70.27,
        68.01,
        68.14,
        11246086,
      ],
      [
        "10/2/2019",
        67.76,
        67.8,
        66.19,
        66.28,
        12337827,
      ],
      [
        "10/3/2019",
        66.08,
        66.73,
        64.79,
        66.72,
        10448695,
      ],
      [
        "10/4/2019",
        66.76,
        68.24,
        66.665,
        68.14,
        9121574,
      ],
      [
        "10/7/2019",
        67.87,
        68.84,
        67.865,
        68.15,
        6871819,
      ],
      [
        "10/8/2019",
        67.03,
        67.18,
        66.025,
        66.4,
        12070938,
      ],
      [
        "10/9/2019",
        67,
        67.77,
        66.79,
        67.44,
        7432477,
      ],
      [
        "10/10/2019",
        67.77,
        69.29,
        67.55,
        68.64,
        8498420,
      ],
      [
        "10/11/2019",
        69.99,
        70.93,
        69.99,
        70.09,
        13066411,
      ],
      [
        "10/14/2019",
        69.7,
        70.495,
        69.65,
        70.28,
        9822360,
      ],
      [
        "10/15/2019",
        70.17,
        72.08,
        68.7,
        71.23,
        20164771,
      ],
      [
        "10/16/2019",
        70.82,
        71.46,
        69.42,
        69.51,
        14434518,
      ],
      [
        "10/17/2019",
        70.03,
        70.34,
        69.18,
        69.605,
        10200087,
      ],
      [
        "10/18/2019",
        69.32,
        70.09,
        69.14,
        69.73,
        9665630,
      ],
      [
        "10/21/2019",
        70.52,
        71.89,
        70.52,
        71.82,
        11607891,
      ],
      [
        "10/22/2019",
        71.72,
        72.87,
        71.47,
        72.08,
        9819698,
      ],
      [
        "10/23/2019",
        71.9,
        72.47,
        71.73,
        72.4551,
        8318291,
      ],
      [
        "10/24/2019",
        72.55,
        72.86,
        71.86,
        72.3,
        6630158,
      ],
      [
        "10/25/2019",
        71.97,
        73.42,
        71.81,
        73.17,
        9389303,
      ],
      [
        "10/28/2019",
        73.73,
        74.28,
        73.4447,
        73.61,
        11378657,
      ],
      [
        "10/29/2019",
        73.14,
        73.79,
        72.72,
        73.09,
        8706325,
      ],
      [
        "10/30/2019",
        72.75,
        73.353,
        72.1,
        73,
        11284844,
      ],
      [
        "10/31/2019",
        71.55,
        72.0276,
        71.46,
        71.8651,
        9652307,
      ],
      [
        "11/1/2019",
        72.25,
        73.99,
        72.1316,
        73.86,
        11004872,
      ],
      [
        "11/4/2019",
        74.94,
        75.27,
        74.11,
        75.17,
        11421728,
      ],
      [
        "11/5/2019",
        75.19,
        75.97,
        74.64,
        74.84,
        12131282,
      ],
      [
        "11/6/2019",
        74.42,
        75.05,
        73.97,
        74.4,
        9982043,
      ],
      [
        "11/7/2019",
        75.41,
        76.28,
        75.41,
        75.79,
        12175786,
      ],
      [
        "11/8/2019",
        75.48,
        76.11,
        75.055,
        76.105,
        6976805,
      ],
      [
        "11/11/2019",
        75.45,
        76.08,
        75.24,
        75.6,
        4996518,
      ],
      [
        "11/12/2019",
        75.55,
        75.96,
        75.01,
        75.07,
        7997949,
      ],
      [
        "11/13/2019",
        74.25,
        74.91,
        73.71,
        73.91,
        11307426,
      ],
      [
        "11/14/2019",
        73.61,
        74.01,
        73.33,
        73.85,
        8038265,
      ],
      [
        "11/15/2019",
        74.34,
        74.46,
        73.68,
        74.38,
        9153898,
      ],
      [
        "11/18/2019",
        74.29,
        74.64,
        73.56,
        74.4,
        6723511,
      ],
      [
        "11/19/2019",
        74.97,
        75.24,
        74.47,
        74.83,
        6679034,
      ],
      [
        "11/20/2019",
        74.63,
        74.72,
        73.22,
        73.89,
        10682256,
      ],
      [
        "11/21/2019",
        74.08,
        74.63,
        73.51,
        73.89,
        6950158,
      ],
      [
        "11/22/2019",
        74.1,
        74.92,
        73.97,
        74.86,
        6889470,
      ],
      [
        "11/25/2019",
        74.93,
        75.85,
        74.87,
        75.7,
        8465630,
      ],
      [
        "11/26/2019",
        75.84,
        75.84,
        74.82,
        75.46,
        8101920,
      ],
      [
        "11/27/2019",
        75.84,
        76.13,
        75.51,
        75.73,
        6043417,
      ],
      [
        "11/29/2019",
        75.43,
        75.7972,
        74.99,
        75.13,
        4597518,
      ],
      [
        "12/2/2019",
        75.42,
        75.93,
        74.43,
        74.55,
        9848382,
      ],
      [
        "12/3/2019",
        73.38,
        73.47,
        72.5,
        73.3251,
        10927333,
      ],
      [
        "12/4/2019",
        73.83,
        74.59,
        73.42,
        74.24,
        7196373,
      ],
      [
        "12/5/2019",
        74.65,
        74.845,
        74.35,
        74.74,
        7169763,
      ],
      [
        "12/6/2019",
        75.93,
        76.22,
        75.6,
        75.8,
        8433269,
      ],
      [
        "12/9/2019",
        75.18,
        75.92,
        75.0795,
        75.33,
        7248095,
      ],
      [
        "12/10/2019",
        75.07,
        76.27,
        74.87,
        75.77,
        11061330,
      ],
      [
        "12/11/2019",
        76.12,
        76.21,
        75.5,
        75.54,
        9040840,
      ],
      [
        "12/12/2019",
        75.81,
        77.52,
        75.62,
        77.04,
        14184358,
      ],
      [
        "12/13/2019",
        77.05,
        77.83,
        76.06,
        76.37,
        10906574,
      ],
      [
        "12/16/2019",
        77.36,
        77.6,
        76.9,
        76.93,
        10844411,
      ],
      [
        "12/17/2019",
        77.29,
        78.125,
        77.13,
        77.72,
        11311104,
      ],
      [
        "12/18/2019",
        77.7,
        78.33,
        77.66,
        77.92,
        10188442,
      ],
      [
        "12/19/2019",
        78,
        78.52,
        77.945,
        78.2,
        10127053,
      ],
      [
        "12/20/2019",
        78.94,
        79.05,
        78.04,
        78.51,
        16429696,
      ],
      [
        "12/23/2019",
        78.67,
        78.97,
        78.44,
        78.765,
        6858555,
      ],
      [
        "12/24/2019",
        78.7,
        78.94,
        78.46,
        78.59,
        3425954,
      ],
      [
        "12/26/2019",
        78.75,
        79.84,
        78.65,
        79.83,
        8553591,
      ],
      [
        "12/27/2019",
        80,
        80.18,
        79.58,
        79.67,
        6364271,
      ],
      [
        "12/30/2019",
        80.15,
        80.415,
        79.34,
        79.52,
        8660551,
      ],
      [
        "12/31/2019",
        79.32,
        79.94,
        79.1,
        79.89,
        6024348,
      ],
      [
        "1/2/2020",
        80.13,
        81.26,
        80.03,
        81.26,
        9781361,
      ],
      [
        "1/3/2020",
        79.8,
        80.515,
        79.45,
        79.69,
        10540603,
      ],
      [
        "1/6/2020",
        78.72,
        79.55,
        78.72,
        79.46,
        8325360,
      ],
      [
        "1/7/2020",
        79.29,
        79.3,
        78.73,
        78.75,
        8455156,
      ],
      [
        "1/8/2020",
        78.77,
        80,
        78.68,
        79.38,
        9267941,
      ],
      [
        "1/9/2020",
        80.98,
        80.98,
        79.73,
        80.09,
        10514627,
      ],
      [
        "1/10/2020",
        80,
        80.01,
        79.07,
        79.25,
        8415784,
      ],
      [
        "1/13/2020",
        79.5,
        80.715,
        79,
        80.65,
        14562193,
      ],
      [
        "1/14/2020",
        81.2,
        83.11,
        80.97,
        81.9,
        21682380,
      ],
      [
        "1/15/2020",
        81.73,
        82.05,
        80.73,
        81.25,
        13599202,
      ],
      [
        "1/16/2020",
        81.96,
        82.13,
        80.845,
        81.01,
        9401745,
      ],
      [
        "1/17/2020",
        81.16,
        81.4,
        80.805,
        81.11,
        10318542,
      ],
      [
        "1/21/2020",
        80.48,
        80.91,
        79.87,
        79.92,
        17215948,
      ],
      [
        "1/22/2020",
        80.2,
        80.4803,
        79.861,
        80.1,
        12701666,
      ],
      [
        "1/23/2020",
        79.58,
        80.085,
        78.92,
        79.81,
        18987071,
      ],
      [
        "1/24/2020",
        79.62,
        79.67,
        77.64,
        78.41,
        25431732,
      ],
      [
        "1/27/2020",
        76.26,
        77,
        75.85,
        76.66,
        13566823,
      ],
      [
        "1/28/2020",
        77.21,
        78.13,
        76.78,
        77.25,
        9071588,
      ],
      [
        "1/29/2020",
        77.54,
        77.9,
        76.41,
        76.47,
        8002669,
      ],
      [
        "1/30/2020",
        75.74,
        77.54,
        75.5,
        77.42,
        10768884,
      ],
      [
        "1/31/2020",
        75.96,
        76.18,
        73.91,
        74.4,
        13789533,
      ],
      [
        "2/3/2020",
        74.7,
        76.21,
        74.7,
        75.115,
        9313546,
      ],
      [
        "2/4/2020",
        76.75,
        77.27,
        76.43,
        76.5,
        9626772,
      ],
      [
        "2/5/2020",
        77.92,
        78.9783,
        77.81,
        78.86,
        10443860,
      ],
      [
        "2/6/2020",
        79.8,
        79.86,
        78.4,
        78.965,
        8742417,
      ],
      [
        "2/7/2020",
        78.13,
        79.0537,
        78.06,
        78.69,
        7342863,
      ],
      [
        "2/10/2020",
        78.08,
        78.74,
        78.05,
        78.49,
        7174092,
      ],
      [
        "2/11/2020",
        78.75,
        79.55,
        78.64,
        79.08,
        7938631,
      ],
      [
        "2/12/2020",
        79.9,
        80.765,
        79.3,
        79.34,
        8328135,
      ],
      [
        "2/13/2020",
        78.89,
        79.279,
        78.62,
        79.02,
        7176050,
      ],
      [
        "2/14/2020",
        78.89,
        79.09,
        78.45,
        78.79,
        7924773,
      ],
      [
        "2/18/2020",
        78.61,
        78.86,
        77.51,
        77.59,
        8806006,
      ],
      [
        "2/19/2020",
        77.87,
        78.39,
        77.62,
        78.05,
        7530040,
      ],
      [
        "2/20/2020",
        77.66,
        78.695,
        77.31,
        78.22,
        10629291,
      ],
      [
        "2/21/2020",
        77.56,
        77.96,
        76.15,
        76.45,
        12134230,
      ],
      [
        "2/24/2020",
        73.38,
        74.05,
        72.44,
        72.54,
        18106039,
      ],
      [
        "2/25/2020",
        72.63,
        73.21,
        69,
        69.44,
        22964859,
      ],
      [
        "2/26/2020",
        70.02,
        70.61,
        68.16,
        68.18,
        21917969,
      ],
      [
        "2/27/2020",
        66.1,
        66.885,
        64.4,
        64.45,
        30764058,
      ],
      [
        "2/28/2020",
        62,
        64.45,
        61.34,
        63.42,
        36603825,
      ],
      [
        "3/2/2020",
        63.85,
        67.61,
        63.12,
        67.595,
        24021357,
      ],
      [
        "3/3/2020",
        67.86,
        68.43,
        64.47,
        65.01,
        25984334,
      ],
      [
        "3/4/2020",
        66.05,
        67.52,
        64.3632,
        67.39,
        20887132,
      ],
      [
        "3/5/2020",
        64.8,
        65.12,
        63.01,
        63.47,
        23088511,
      ],
      [
        "3/6/2020",
        60.46,
        62.31,
        59.74,
        61.3,
        24999861,
      ],
      [
        "3/9/2020",
        54.31,
        55.61,
        51,
        51.363,
        31679389,
      ],
      [
        "3/10/2020",
        54.73,
        55.7,
        51.5,
        55.57,
        28918412,
      ],
      [
        "3/11/2020",
        53.95,
        54.33,
        50.02,
        50.79,
        34033423,
      ],
      [
        "3/12/2020",
        45.3,
        49,
        42.82,
        43.27,
        41152522,
      ],
      [
        "3/13/2020",
        47.82,
        51.24,
        45.31,
        51.045,
        36980534,
      ],
      [
        "3/16/2020",
        40.49,
        45.23,
        39.57,
        41.185,
        30316410,
      ],
      [
        "3/17/2020",
        42,
        43.98,
        38.8,
        40.2,
        46122674,
      ],
      [
        "3/18/2020",
        37.06,
        37.99,
        32,
        36.41,
        38805474,
      ],
      [
        "3/19/2020",
        35.47,
        41.24,
        34.2,
        39.64,
        40565903,
      ],
      [
        "3/20/2020",
        40.46,
        40.99,
        37.2,
        38.06,
        33812188,
      ],
      [
        "3/23/2020",
        37.55,
        38.15,
        34.62,
        35.31,
        30282697,
      ],
      [
        "3/24/2020",
        37.65,
        40.92,
        37.34,
        40.64,
        30607389,
      ],
      [
        "3/25/2020",
        42.31,
        44.7,
        39.43,
        41.85,
        32353136,
      ],
      [
        "3/26/2020",
        43.68,
        46.29,
        43,
        46,
        28498186,
      ],
      [
        "3/27/2020",
        44.13,
        45.5,
        43,
        43.78,
        22546901,
      ],
      [
        "3/30/2020",
        44.05,
        44.26,
        41.57,
        44.09,
        25321957,
      ],
      [
        "3/31/2020",
        43.63,
        44.225,
        41.65,
        42.09,
        21540820,
      ],
      [
        "4/1/2020",
        39.14,
        40.25,
        38,
        38.52,
        26825013,
      ],
      [
        "4/2/2020",
        38.36,
        39.66,
        37.3,
        39.23,
        26631072,
      ],
      [
        "4/3/2020",
        39,
        39.46,
        36.67,
        37.47,
        23694174,
      ],
      [
        "4/6/2020",
        39.8,
        41.335,
        39.51,
        41.11,
        27131977,
      ],
      [
        "4/7/2020",
        44.81,
        45.59,
        41.12,
        41.25,
        32079891,
      ],
      [
        "4/8/2020",
        42.85,
        44.445,
        41.9693,
        44.25,
        27717042,
      ],
      [
        "4/9/2020",
        46.94,
        49.22,
        46.365,
        47.42,
        41235838,
      ],
      [
        "4/13/2020",
        47.5,
        47.57,
        45.27,
        46.67,
        25314657,
      ],
      [
        "4/14/2020",
        47.66,
        47.74,
        43.525,
        45.4,
        37878577,
      ],
      [
        "4/15/2020",
        43.37,
        44.27,
        42.61,
        42.87,
        29675070,
      ],
      [
        "4/16/2020",
        42.71,
        42.84,
        40.1,
        40.5,
        35366848,
      ],
      [
        "4/17/2020",
        43.15,
        45.62,
        42.65,
        45.41,
        38121722,
      ],
      [
        "4/20/2020",
        43.395,
        45.44,
        42.885,
        44.01,
        30694501,
      ],
      [
        "4/21/2020",
        42.35,
        43.11,
        41.07,
        41.57,
        34379404,
      ],
      [
        "4/22/2020",
        43,
        43.12,
        41.85,
        42.34,
        19489910,
      ],
      [
        "4/23/2020",
        42.65,
        43.74,
        42.26,
        42.45,
        22664344,
      ],
      [
        "4/24/2020",
        43,
        43.34,
        41.73,
        43.11,
        24816436,
      ],
      [
        "4/27/2020",
        44.17,
        46.82,
        43.73,
        46.56,
        28321221,
      ],
      [
        "4/28/2020",
        48.94,
        49.59,
        46.93,
        47.21,
        27524503,
      ],
      [
        "4/29/2020",
        49.7,
        50.65,
        48.455,
        50.26,
        28469108,
      ],
      [
        "4/30/2020",
        49.07,
        49.77,
        48.04,
        48.56,
        23668187,
      ],
      [
        "5/1/2020",
        46.31,
        46.47,
        45.22,
        45.52,
        26398171,
      ],
      [
        "5/4/2020",
        45.17,
        45.36,
        43.98,
        45.12,
        22553292,
      ],
      [
        "5/5/2020",
        46.3,
        46.35,
        43.92,
        43.95,
        24473973,
      ],
      [
        "5/6/2020",
        44.49,
        45.02,
        42.72,
        42.94,
        21445914,
      ],
      [
        "5/7/2020",
        43.58,
        45.16,
        43.4375,
        44.65,
        24435469,
      ],
      [
        "5/8/2020",
        45.32,
        46.42,
        45.26,
        46.32,
        20991555,
      ],
      [
        "5/11/2020",
        45.2,
        45.25,
        43.81,
        44.05,
        30523920,
      ],
      [
        "5/12/2020",
        44.39,
        44.69,
        42.32,
        42.36,
        28106371,
      ],
      [
        "5/13/2020",
        42,
        42.2,
        40.23,
        40.61,
        31506577,
      ],
      [
        "5/14/2020",
        39.96,
        42.1,
        38.76,
        42.07,
        37972837,
      ],
      [
        "5/15/2020",
        41.58,
        42.45,
        41.1,
        41.92,
        24914556,
      ],
      [
        "5/18/2020",
        44.05,
        45.91,
        43.49,
        45.6685,
        35974388,
      ],
      [
        "5/19/2020",
        45.27,
        45.79,
        44.21,
        44.425,
        23792540,
      ],
      [
        "5/20/2020",
        45.57,
        46.28,
        45.22,
        45.48,
        21754063,
      ],
      [
        "5/21/2020",
        45.17,
        45.79,
        44.782,
        45.02,
        17895096,
      ],
      [
        "5/22/2020",
        44.77,
        45.045,
        43.69,
        44.1,
        21647278,
      ],
      [
        "5/26/2020",
        46.2,
        48.9,
        45.98,
        48.17,
        31836784,
      ],
      [
        "5/27/2020",
        51.68,
        52.39,
        49.86,
        52.27,
        40842988,
      ],
      [
        "5/28/2020",
        52.99,
        53.01,
        49.11,
        49.135,
        35937247,
      ],
      [
        "5/29/2020",
        48.02,
        49.48,
        47.56,
        47.93,
        28770371,
      ],
      [
        "6/1/2020",
        48.14,
        49.68,
        47.82,
        49.46,
        21227878,
      ],
      [
        "6/2/2020",
        50.71,
        51.29,
        50.16,
        50.84,
        25542858,
      ],
      [
        "6/3/2020",
        52.56,
        53.76,
        52.42,
        53.345,
        28881338,
      ],
      [
        "6/4/2020",
        53.3,
        55.69,
        52.61,
        55.66,
        31447411,
      ],
      [
        "6/5/2020",
        61.57,
        62.47,
        58.34,
        58.915,
        41395402,
      ],
      [
        "6/8/2020",
        60.66,
        61.33,
        59.77,
        61.2,
        28265269,
      ],
      [
        "6/9/2020",
        59,
        60.2,
        57.65,
        59.5815,
        28786501,
      ],
      [
        "6/10/2020",
        58.9,
        59.14,
        55.86,
        55.88,
        35024720,
      ],
      [
        "6/11/2020",
        51.67,
        53.515,
        48.2,
        48.32,
        57588986,
      ],
      [
        "6/12/2020",
        51.4,
        51.78,
        50.1006,
        50.105,
        13764311,
      ],
      [
        "6/15/2020",
        49.96,
        53,
        49.74,
        52.985,
        34502397,
      ],
      [
        "6/16/2020",
        56.3,
        56.4,
        52.32,
        54.49,
        34395693,
      ],
      [
        "6/17/2020",
        54.7,
        54.8,
        52.88,
        52.99,
        20996087,
      ],
      [
        "6/18/2020",
        52.67,
        53.65,
        52.03,
        53.01,
        19922713,
      ],
      [
        "6/19/2020",
        54.06,
        54.09,
        51.56,
        52.58,
        32772797,
      ],
      [
        "6/22/2020",
        51.85,
        52.57,
        51.52,
        52.06,
        17796082,
      ],
      [
        "6/23/2020",
        52.95,
        53.73,
        52.5,
        52.95,
        19343138,
      ],
      [
        "6/24/2020",
        51.67,
        51.84,
        50.1643,
        50.83,
        24345141,
      ],
      [
        "6/25/2020",
        50.3,
        52.79,
        50.13,
        52.695,
        23948185,
      ],
      [
        "6/26/2020",
        52.34,
        52.34,
        49.47,
        49.585,
        27633064,
      ],
      [
        "6/29/2020",
        50.28,
        50.92,
        49.61,
        50.31,
        21246552,
      ],
      [
        "6/30/2020",
        49.81,
        51.55,
        49.65,
        51.1,
        20248600,
      ],
      [
        "7/1/2020",
        51.76,
        51.995,
        50.15,
        50.35,
        17603150,
      ],
      [
        "7/2/2020",
        52.12,
        52.455,
        50.2843,
        50.54,
        21082670,
      ],
      [
        "7/6/2020",
        51.87,
        52.56,
        51.185,
        51.97,
        19678458,
      ],
      [
        "7/7/2020",
        51.25,
        51.355,
        50.09,
        50.33,
        19867633,
      ],
      [
        "7/8/2020",
        50.2,
        51.07,
        49.94,
        50.9,
        17859168,
      ],
      [
        "7/9/2020",
        50.73,
        51.08,
        49.03,
        49.47,
        23415709,
      ],
      [
        "7/10/2020",
        49.45,
        52.69,
        49.45,
        52.64,
        26622429,
      ],
      [
        "7/13/2020",
        53.33,
        53.6,
        51.86,
        52.24,
        23432443,
      ],
      [
        "7/14/2020",
        51.29,
        52.0809,
        50.01,
        50.15,
        32264468,
      ],
      [
        "7/15/2020",
        51.9,
        52.11,
        50.68,
        51.84,
        25290743,
      ],
      [
        "7/16/2020",
        51.28,
        52.455,
        50.935,
        51.55,
        17417917,
      ],
      [
        "7/17/2020",
        51.22,
        51.48,
        50.2,
        50.22,
        19025723,
      ],
      [
        "7/20/2020",
        49.99,
        50.58,
        49.75,
        50.14,
        18485255,
      ],
      [
        "7/21/2020",
        50.9,
        51.82,
        50.67,
        51.72,
        19411045,
      ],
      [
        "7/22/2020",
        51.54,
        52.28,
        51.145,
        51.66,
        17263465,
      ],
      [
        "7/23/2020",
        51.45,
        52.23,
        51.13,
        52.08,
        11171752,
      ],
      [
        "7/24/2020",
        52.1,
        52.48,
        51.5,
        51.67,
        15401884,
      ],
      [
        "7/27/2020",
        51.46,
        51.46,
        50.605,
        51.29,
        13334275,
      ],
      [
        "7/28/2020",
        51.02,
        51.66,
        50.99,
        51.26,
        20238043,
      ],
      [
        "7/29/2020",
        51.17,
        52.59,
        50.99,
        52.51,
        32404816,
      ],
      [
        "7/30/2020",
        51.11,
        51.2,
        49.86,
        50.87,
        46413577,
      ],
      [
        "7/31/2020",
        50.26,
        50.31,
        49.3678,
        50.05,
        35970593,
      ],
      [
        "8/3/2020",
        50.56,
        50.85,
        49.69,
        50.41,
        23526059,
      ],
      [
        "8/4/2020",
        50.23,
        50.32,
        49.85,
        50.13,
        31396233,
      ],
      [
        "8/5/2020",
        50.5,
        51.31,
        50.47,
        51.04,
        29068037,
      ],
      [
        "8/6/2020",
        50.75,
        51.29,
        50.58,
        50.905,
        20610948,
      ],
      [
        "8/7/2020",
        50.52,
        52.23,
        50.13,
        52.12,
        37476655,
      ],
      [
        "8/10/2020",
        53.16,
        53.19,
        52.53,
        52.87,
        24422532,
      ],
      [
        "8/11/2020",
        54.45,
        55.027,
        53.54,
        53.76,
        46185803,
      ],
      [
        "8/12/2020",
        54.94,
        55.0185,
        52.745,
        53.36,
        35424438,
      ],
      [
        "8/13/2020",
        52.83,
        53.48,
        52.57,
        52.89,
        13084589,
      ],
      [
        "8/14/2020",
        52.45,
        53.345,
        52.355,
        52.94,
        12574976,
      ],
      [
        "8/17/2020",
        52.63,
        52.82,
        51.35,
        51.46,
        36404543,
      ],
      [
        "8/18/2020",
        51.52,
        51.53,
        50.28,
        50.345,
        31823316,
      ],
      [
        "8/19/2020",
        50.68,
        51.33,
        50,
        50.29,
        38922159,
      ],
      [
        "8/20/2020",
        49.53,
        50.015,
        49.23,
        49.59,
        29797982,
      ],
      [
        "8/21/2020",
        49.45,
        50.08,
        49.1599,
        49.3,
        30983154,
      ],
      [
        "8/24/2020",
        49.9,
        51.13,
        49.45,
        51.07,
        36945675,
      ],
      [
        "8/25/2020",
        51.85,
        52.505,
        50.97,
        51.66,
        33135868,
      ],
      [
        "8/26/2020",
        51.66,
        51.79,
        50.815,
        50.85,
        26226988,
      ],
      [
        "8/27/2020",
        50.72,
        52.2101,
        50.65,
        51.73,
        37125194,
      ],
      [
        "8/28/2020",
        52.07,
        52.37,
        51.525,
        52.27,
        30745789,
      ],
      [
        "8/31/2020",
        51.91,
        52.04,
        51.1,
        51.1,
        27488061,
      ],
      [
        "9/1/2020",
        50.88,
        51.565,
        50.54,
        51.2,
        31927287,
      ],
      [
        "9/2/2020",
        51.04,
        52.14,
        50.6575,
        51.94,
        28788733,
      ],
      [
        "9/3/2020",
        52.44,
        53.64,
        51.23,
        51.5,
        46940487,
      ],
      [
        "9/4/2020",
        52.47,
        53.36,
        51.44,
        52.5,
        47280319,
      ],
      [
        "9/8/2020",
        51.92,
        52.09,
        50.6599,
        51.05,
        52313342,
      ],
      [
        "9/9/2020",
        51.2,
        51.59,
        50.615,
        51.4,
        34775715,
      ],
      [
        "9/10/2020",
        52.455,
        52.5,
        50.7,
        50.94,
        34614495,
      ],
      [
        "9/11/2020",
        50.89,
        51.685,
        50.8,
        51,
        38027201,
      ],
      [
        "9/14/2020",
        51.49,
        52.08,
        47.9,
        48.155,
        111374530,
      ],
      [
        "9/15/2020",
        48.12,
        48.39,
        44.67,
        44.8177,
        77530385,
      ],
      [
        "9/16/2020",
        45.21,
        46.76,
        44.62,
        46.03,
        42386555,
      ],
      [
        "9/17/2020",
        45.44,
        45.83,
        45.01,
        45.53,
        22323768,
      ],
      [
        "9/18/2020",
        45.52,
        45.96,
        44.755,
        44.845,
        25898789,
      ],
      [
        "9/21/2020",
        43.4,
        44.155,
        43.07,
        43.93,
        25932898,
      ],
      [
        "9/22/2020",
        43.79,
        44.13,
        43.075,
        43.29,
        22321757,
      ],
      [
        "9/23/2020",
        43.61,
        43.95,
        41.79,
        41.85,
        24572101,
      ],
      [
        "9/24/2020",
        41.85,
        42.595,
        41.29,
        42.19,
        27097409,
      ],
      [
        "9/25/2020",
        41.84,
        42.13,
        41.52,
        42.02,
        24755429,
      ],
      [
        "9/28/2020",
        42.92,
        43.88,
        42.89,
        43.35,
        18496204,
      ],
      [
        "9/29/2020",
        43.1,
        43.29,
        42.02,
        42.41,
        38857384,
      ],
      [
        "9/30/2020",
        42.58,
        43.59,
        42.5,
        43.06,
        37816289,
      ],
      [
        "10/1/2020",
        43.33,
        43.65,
        42.6,
        43.45,
        39270744,
      ],
      [
        "10/2/2020",
        42.54,
        43.87,
        42.52,
        43.66,
        42244576,
      ],
      [
        "10/5/2020",
        44.26,
        45.23,
        44.21,
        44.9,
        45164054,
      ],
      [
        "10/6/2020",
        45.475,
        46.06,
        44.16,
        44.38,
        52309889,
      ],
      [
        "10/7/2020",
        45.02,
        45.63,
        44.61,
        44.84,
        36428788,
      ],
      [
        "10/8/2020",
        44.91,
        45.17,
        44.28,
        44.72,
        53679726,
      ],
      [
        "10/9/2020",
        45.01,
        45.59,
        44.69,
        44.91,
        44345861,
      ],
      [
        "10/12/2020",
        45.09,
        45.99,
        44.95,
        45.88,
        45139746,
      ],
      [
        "10/13/2020",
        46.12,
        46.12,
        43.55,
        43.63,
        91877966,
      ],
      [
        "10/14/2020",
        43.52,
        44.235,
        43,
        43.05,
        55611628,
      ],
      [
        "10/15/2020",
        42.54,
        43.635,
        42.25,
        43.6,
        47749621,
      ],
      [
        "10/16/2020",
        43.68,
        43.88,
        43.08,
        43.185,
        48655364,
      ],
      [
        "10/19/2020",
        43.35,
        43.39,
        42.81,
        42.89,
        36671978,
      ],
      [
        "10/20/2020",
        43.37,
        44.08,
        43.34,
        43.51,
        38239004,
      ],
      [
        "10/21/2020",
        43.46,
        43.7299,
        42.9,
        43,
        30892876,
      ],
      [
        "10/22/2020",
        42.89,
        43.99,
        42.66,
        43.96,
        37518774,
      ],
      [
        "10/23/2020",
        44.21,
        44.57,
        43.675,
        43.96,
        32695403,
      ],
      [
        "10/26/2020",
        43.36,
        43.4,
        42.81,
        43.26,
        41673464,
      ],
      [
        "10/27/2020",
        43.04,
        43.04,
        41.87,
        41.88,
        44540852,
      ],
      [
        "10/28/2020",
        40.97,
        41.59,
        40.745,
        41.15,
        45805906,
      ],
      [
        "10/29/2020",
        41.13,
        42.15,
        40.71,
        41.66,
        42470062,
      ],
      [
        "10/30/2020",
        41.03,
        41.54,
        40.49,
        41.41,
        44344024,
      ],
      [
        "11/2/2020",
        41.86,
        42.67,
        41.2,
        42.21,
        43417494,
      ],
      [
        "11/3/2020",
        43.3,
        44.02,
        43.06,
        43.62,
        44348957,
      ],
      [
        "11/4/2020",
        42.53,
        43.41,
        41.895,
        42.0822,
        44939635,
      ],
      [
        "11/5/2020",
        42.34,
        43.58,
        42.18,
        43.05,
        45147639,
      ],
      [
        "11/6/2020",
        43.51,
        43.61,
        42.5,
        42.73,
        32195082,
      ],
      [
        "11/9/2020",
        46.87,
        48.78,
        46.26,
        47.68,
        101235978,
      ],
      [
        "11/10/2020",
        48.31,
        48.75,
        47.45,
        47.66,
        62511192,
      ],
      [
        "11/11/2020",
        47.9,
        49.29,
        47.68,
        48.94,
        55448017,
      ],
      [
        "11/12/2020",
        47.97,
        48.41,
        47.71,
        48.28,
        51223175,
      ],
      [
        "11/13/2020",
        48.65,
        49.02,
        48.4,
        48.73,
        25541217,
      ],
      [
        "11/16/2020",
        50.41,
        51.02,
        50,
        50.0323,
        36860856,
      ],
      [
        "11/17/2020",
        49.84,
        50.93,
        49.48,
        50.745,
        34226731,
      ],
      [
        "11/18/2020",
        51.09,
        52.645,
        51.01,
        51.05,
        48217518,
      ],
      [
        "11/19/2020",
        51.6,
        52.32,
        50.95,
        52.13,
        36557060,
      ],
      [
        "11/20/2020",
        51.83,
        52.11,
        51.19,
        51.64,
        28197147,
      ],
      [
        "11/23/2020",
        52.51,
        53.63,
        52.29,
        53.29,
        45462405,
      ],
      [
        "11/24/2020",
        54.48,
        57.14,
        54.48,
        57.05,
        61334687,
      ],
      [
        "11/25/2020",
        56.27,
        57.16,
        55.33,
        57.06,
        52833987,
      ],
      [
        "11/27/2020",
        57,
        57.24,
        56.12,
        56.71,
        26016394,
      ],
      [
        "11/30/2020",
        56.14,
        56.54,
        54.995,
        55.08,
        18980824,
      ],
      [
        "12/1/2020",
        56.55,
        56.74,
        55.4,
        55.46,
        20951717,
      ],
      [
        "12/2/2020",
        55.36,
        57.415,
        55.25,
        57.2,
        24624538,
      ],
      [
        "12/3/2020",
        57.38,
        57.445,
        56.2,
        56.59,
        16631716,
      ],
      [
        "12/4/2020",
        57.56,
        58.82,
        57.31,
        58.62,
        21111514,
      ],
      [
        "12/7/2020",
        58.15,
        58.61,
        57.28,
        58.14,
        19198859,
      ],
      [
        "12/8/2020",
        57.48,
        58.4,
        57.36,
        58.35,
        13959498,
      ],
      [
        "12/9/2020",
        59.16,
        59.55,
        58.3,
        58.94,
        24651475,
      ],
      [
        "12/10/2020",
        58.04,
        60.785,
        58.01,
        60.5,
        23620300,
      ],
      [
        "12/11/2020",
        59.8,
        59.81,
        58.18,
        58.93,
        19199075,
      ],
      [
        "12/14/2020",
        60,
        60.255,
        58.73,
        58.7362,
        16247239,
      ],
      [
        "12/15/2020",
        58.74,
        59.859,
        58.57,
        59.68,
        13648518,
      ],
      [
        "12/16/2020",
        60.065,
        60.14,
        59.36,
        59.75,
        11265662,
      ],
      [
        "12/17/2020",
        60,
        60.29,
        59.5699,
        60.04,
        13633863,
      ],
      [
        "12/18/2020",
        60.3,
        60.3,
        58.71,
        59.06,
        20732611,
      ],
      [
        "12/21/2020",
        60.35,
        61.82,
        59.81,
        61.22,
        28991011,
      ],
      [
        "12/22/2020",
        61.1,
        61.1393,
        59.155,
        59.2601,
        15702559,
      ],
      [
        "12/23/2020",
        60,
        61.31,
        59.79,
        60.77,
        15172277,
      ],
      [
        "12/24/2020",
        60.93,
        61.09,
        59.88,
        60.56,
        6453891,
      ],
      [
        "12/28/2020",
        60.62,
        61.93,
        60.49,
        61.12,
        12454823,
      ],
      [
        "12/29/2020",
        61.15,
        61.3999,
        60.55,
        60.92,
        10120070,
      ],
      [
        "12/30/2020",
        60.91,
        61.265,
        60.67,
        60.88,
        9893338,
      ],
      [
        "12/31/2020",
        60.67,
        61.85,
        60.53,
        61.66,
        10759218,
      ],
      [
        "1/4/2021",
        61.59,
        61.7083,
        59.73,
        60.1498,
        18920844,
      ],
    ]);
    
    //plot0: candlestick
    let mapping = table.mapAs({'open':1, 'high':2, 'low':3, 'close':4, 'value':4});
    let plot0 = this.chart.plot(0);
    plot0.yGrid().stroke({dash:"2 14"});
    plot0.area(mapping).name(ticker).fill('#3248EC').stroke("#45F4FC");
    plot0.title(`${ticker} candlestick`);
    plot0.title().fontWeight(1000);
    plot0.xAxis().ticks(true);
    plot0.yAxis().ticks(true).minorTicks(true);
    plot0.crosshair().xStroke('#ca68ff', 1.6, "round");
    plot0.crosshair().yStroke('#ca68ff', 1.6, "round");

    // EMAs on 1st plot
    let ema15 = plot0.ema(mapping, 25).series();//.series();
    //ema15.stroke('#bf360c');
    let ema50 = plot0.ema(mapping, 100).series();
    
    // plot1: volume
    let volMapping = table.mapAs({'value': 5});
    let plot1 = this.chart.plot(1);
    plot1.yGrid().stroke({dash:"2 14"});
    plot1.column(volMapping).name('Volume');
    plot1.title('Volume');
    plot1.title().fontWeight(1000);
    plot1.xAxis().ticks(true).minorTicks(true);
    plot1.yAxis().ticks(true).minorTicks(true);
    plot1.yAxis().labels().position('left').anchor('left');

    let grouping = this.chart.grouping();
    grouping.enabled(true);

    // configure scroller
    this.chart.scroller().fill('#D1F37D');
    this.chart.scroller().selectedFill('#BFE6A9');
    this.chart.scroller().column(mapping).fill('#939393');
    let labels = this.chart.scroller().xAxis().labels().fontWeight(600).fontColor('#464646');
    let minorLabels = this.chart.scroller().xAxis().minorLabels().fontWeight(600).fontColor('#464646');

    this.chart.padding("2%", 2, 2, "3%");
    this.chart.container(this.container.nativeElement);
    this.chart.draw();
  }

  ConvertIAggArrayToArrayOfArrays(inputArray: IAgg[]): any[][]{
    let arrayOfArrays: any[][]= [];
    inputArray.forEach((agg) => {
      arrayOfArrays.push([ new Date(agg.time).toLocaleDateString(), agg.open, agg.high, agg.low, agg.close, agg.volume]);
    });
    return arrayOfArrays;
  }

  ConvertDate(date: Date){
    return new Date(date).toLocaleDateString();
  }

  goBack(): void {
    this.location.back();
  }

  messageClick() {
    this.errorMsg = '';
  }

  ngOnDestroy(): void {
    if (this.subscriptions && this.subscriptions.length > 0) {
      this.subscriptions.forEach((sub) => {
        if (!sub.closed) { sub.unsubscribe(); }     
      });
    }
  } 

}
